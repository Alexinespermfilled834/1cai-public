# BSL Test Manifest

`tests/bsl/testplan.json` описывает запуск тестов 1С/BSL внутри CI. Формат — массив объектов.

## Структура тестов

В директории `tests/bsl/` находятся следующие тестовые файлы:

1. **test_ai_generated_code.bsl** — Тесты для AI-сгенерированного кода
   - Проверка корректности функций, сгенерированных AI агентами
   - Валидация типов и обработки ошибок

2. **test_parsers.bsl** — Тесты для парсеров BSL и метаданных
   - Проверка парсинга конфигураций 1С
   - Синхронизация с PostgreSQL
   - Парсинг модулей BSL

3. **test_integrations.bsl** — Тесты для интеграций с БД
   - Полный цикл парсинг → сохранение → поиск
   - Векторный поиск в Qdrant
   - Синхронизация Neo4j с PostgreSQL

4. **test_mcp_tools.bsl** — Тесты для MCP инструментов
   - Поиск метаданных
   - Семантический поиск
   - Генерация кода

## Формат testplan.json

```json
[
  {
    "name": "yaxunit-ai-generated-code",
    "command": [
      "oscript",
      "tools/yaxunit/src/cli/yaxunit-runner.os",
      "--workspace",
      "tests/bsl",
      "--test-file",
      "test_ai_generated_code.bsl"
    ],
    "working_directory": "tests/bsl",
    "env": {
      "YAXUNIT_OPTS": "--report=junit --output=output/bsl-tests/reports"
    },
    "timeout": 1800
  }
]
```

## Как подключить проекты

1. Установить OneScript и подготовить YAxUnit/Vanessa (см. [alkoleft/yaxunit](https://github.com/alkoleft/yaxunit) — благодарим @alkoleft за открытый фреймворк и документацию).
2. Добавить запись в `testplan.json`, указав команду запуска, рабочую директорию, переменные окружения и таймаут.
3. Локально выполнить `make test-bsl` и убедиться, что логи попадают в `output/bsl-tests`.
4. Закоммитить изменения и проверить job `BSL Tests` в GitHub Actions.

Логи и артефакты автоматически выгружаются в CI (`bsl-test-artifacts`). После внедрения конкретных сценариев расширите документацию (HLD/README/CASE_STUDIES) и добавьте ссылку на использованный репозиторий с благодарностью.

## Примеры использования YAxUnit

### Базовый тест

```bsl
Процедура Тест_Пример() Экспорт
    
    // Arrange
    Значение = 100;
    
    // Act
    Результат = Функция(Значение);
    
    // Assert
    ЮТест.ОжидаетЧто(Результат, "Результат функции")
        .Заполнено()
        .ИмеетТип("Число")
        .Равно(100);
    
КонецПроцедуры
```

### Тест с предикатом

```bsl
Процедура Тест_СПредикатом() Экспорт
    
    Условие = ЮТест.Предикат()
        .Реквизит("Тип").Равно("Справочник")
        .И().Реквизит("Имя").Равно("Пользователи")
        .Получить();
    
    ЮТест.ОжидаетЧто(Результат, "Результат")
        .СодержитЭлемент(Условие);
    
КонецПроцедуры
```

### Тест с базой данных

```bsl
Процедура Тест_БазаДанных() Экспорт
    
    УсловиеПоиска = ЮТест.Предикат()
        .Реквизит("name").Равно("Тест")
        .Получить();
    
    ЮТест.ОжидаетЧтоТаблицаБазы("configurations", "Конфигурация в БД")
        .СодержитЗапись(УсловиеПоиска);
    
КонецПроцедуры
```

## Интеграция с AI генерацией

AI Agent Extended теперь автоматически генерирует YAxUnit тесты для сгенерированного кода:

```python
from src.ai.agents.qa_engineer_agent_extended import QAEngineerAgentExtended

qa_agent = QAEngineerAgentExtended()
yaxunit_tests = await qa_agent.generate_yaxunit_tests_for_ai_code(
    generated_code="Функция Тест()...",
    function_name="Тест"
)
```

Сгенерированные тесты сохраняются в `tests/bsl/` и автоматически запускаются через CI/CD.
