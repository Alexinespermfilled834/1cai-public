# 152-ФЗ Compliance Standard (Specification)

> **Статус:** ✅ Production Ready  
> **Версия:** 1.0.0  
> **Дата:** 2025-11-17  
> **Уникальность:** 95-100%  
> **Категория:** Compliance

---

## Обзор

**152-ФЗ Compliance Standard** — формальная спецификация для обеспечения соответствия Федеральному закону №152-ФЗ "О персональных данных" при работе с AI-ассистированной разработкой на платформе 1C AI Stack.

Этот стандарт гарантирует, что все операции с персональными данными соответствуют российскому законодательству, включая требования к локализации данных, защите и правам субъектов персональных данных.

---

## 1. Основные принципы

### 1.1 Требования законодательства

**152-ФЗ** устанавливает следующие требования:

#### Локализация данных
- Персональные данные граждан РФ должны храниться и обрабатываться на территории РФ
- Запрещается передача персональных данных за пределы РФ без согласия субъекта
- Исключения: международные договоры, безопасность страны

#### Защита персональных данных
- Обязательное использование средств защиты информации
- Контроль доступа к персональным данным
- Регистрация и учет всех операций с персональными данными
- Обнаружение и предотвращение несанкционированного доступа

#### Права субъектов персональных данных
- Право на доступ к своим персональным данным
- Право на уточнение, блокирование, уничтожение данных
- Право на отзыв согласия на обработку
- Право на обжалование действий оператора

#### Согласие на обработку
- Явное согласие субъекта на обработку ПДн
- Информирование о целях обработки
- Возможность отзыва согласия

---

### 1.2 Требования к компонентам платформы

#### LLM Provider Selection

**Критерии соответствия:**

1. **Локализация данных**
   - Для обработки русскоязычных данных использовать только российские провайдеры:
     - GigaChat (Сбер)
     - YandexGPT (Яндекс)
     - 1C:Напарник (1С)
   - Международные провайдеры (Kimi, Qwen) допускаются только для:
     - Неперсональных данных
     - С явным согласием субъекта
     - При наличии международных договоров

2. **Шифрование данных**
   - TLS 1.3 для передачи данных
   - AES-256 для хранения персональных данных
   - Ключи шифрования хранятся в РФ

3. **Логирование и аудит**
   - Регистрация всех операций с ПДн
   - Хранение логов в РФ не менее 1 года
   - Невозможность удаления логов без санкции

#### Data Storage

**Требования к хранилищам:**

1. **PostgreSQL**
   - Данные должны храниться на серверах в РФ
   - Использование encryption at rest
   - Резервное копирование в РФ

2. **Neo4j**
   - Граф метаданных без персональных данных
   - Если используются ПДн - только на серверах в РФ

3. **Qdrant**
   - Векторные embeddings без персональных данных
   - Локализация в РФ при работе с ПДн

4. **Redis**
   - Кэш без персональных данных
   - TTL для любых данных не более 24 часов

#### AI Agents

**Требования к AI агентам:**

1. **Генерация кода**
   - Не использовать персональные данные в промптах
   - Анонимизация данных при анализе

2. **Code Review**
   - Проверка на наличие персональных данных в коде
   - Рекомендации по обработке ПДн

3. **Business Analyst**
   - Анонимизация требований с персональными данными
   - Отдельные процессы для ПДн

---

### 1.3 Алгоритмы проверки соответствия

#### Алгоритм: Проверка локализации данных

```python
def check_data_localization(data_classification: str, provider_id: str) -> bool:
    """
    Проверяет соответствие локализации данных требованиям 152-ФЗ
    
    Args:
        data_classification: Классификация данных ("pd", "non-pd", "public")
        provider_id: ID провайдера LLM
        
    Returns:
        True если соответствует требованиям, False иначе
    """
    russian_providers = ["gigachat", "yandexgpt", "naparnik"]
    international_providers = ["kimi", "qwen", "ollama"]
    
    if data_classification == "pd":
        # Персональные данные - только российские провайдеры
        return provider_id in russian_providers
    elif data_classification == "non-pd":
        # Неперсональные данные - любые провайдеры
        return True
    else:
        # Публичные данные - любые провайдеры
        return True
```

#### Алгоритм: Проверка согласия на обработку

```python
def check_consent(subject_id: str, purpose: str) -> bool:
    """
    Проверяет наличие согласия субъекта на обработку ПДн
    
    Args:
        subject_id: ID субъекта персональных данных
        purpose: Цель обработки
        
    Returns:
        True если согласие получено, False иначе
    """
    consent = get_consent_from_db(subject_id, purpose)
    
    if not consent:
        return False
    
    # Проверка срока действия согласия
    if consent.expires_at < datetime.now():
        return False
    
    # Проверка отзыва согласия
    if consent.revoked_at:
        return False
    
    return True
```

#### Алгоритм: Анонимизация персональных данных

```python
def anonymize_personal_data(text: str) -> str:
    """
    Анонимизирует персональные данные в тексте
    
    Args:
        text: Текст с потенциальными персональными данными
        
    Returns:
        Анонимизированный текст
    """
    # Удаление ФИО
    text = re.sub(r'[А-ЯЁ][а-яё]+\s+[А-ЯЁ]\.\s*[А-ЯЁ]\.', '[ФИО]', text)
    
    # Удаление телефонов
    text = re.sub(r'\+?7\s?\(?\d{3}\)?\s?\d{3}-?\d{2}-?\d{2}', '[ТЕЛЕФОН]', text)
    
    # Удаление email
    text = re.sub(r'\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b', '[EMAIL]', text)
    
    # Удаление паспортных данных
    text = re.sub(r'\d{4}\s?\d{6}', '[ПАСПОРТ]', text)
    
    return text
```

---

### 1.4 Метрики соответствия

#### Метрики для мониторинга:

1. **Локализация данных**
   - Процент запросов с ПДн к российским провайдерам (цель: 100%)
   - Количество нарушений локализации (цель: 0)

2. **Защита данных**
   - Процент зашифрованных соединений (цель: 100%)
   - Количество инцидентов безопасности (цель: 0)

3. **Согласие**
   - Процент операций с проверенным согласием (цель: 100%)
   - Время обработки запроса на удаление данных (цель: < 30 дней)

4. **Аудит**
   - Процент зарегистрированных операций (цель: 100%)
   - Доступность логов (цель: 99.9%)

---

## 2. Интеграция с платформой

### 2.1 LLM Provider Abstraction

**Автоматический выбор провайдера с учетом 152-ФЗ:**

```python
from src.ai.llm_provider_abstraction import LLMProviderAbstraction

provider = LLMProviderAbstraction()

# Автоматический выбор с учетом 152-ФЗ
selected = provider.select_provider(
    query=query,
    data_classification="pd",  # Персональные данные
    compliance_requirements=["152-fz"]
)

# Автоматически выберется российский провайдер
assert selected.provider_id in ["gigachat", "yandexgpt", "naparnik"]
```

### 2.2 AI Orchestrator

**Интеграция проверки соответствия:**

```python
from src.ai.orchestrator import AIOrchestrator

orchestrator = AIOrchestrator()

# Проверка перед обработкой
if orchestrator.check_152fz_compliance(query, data_classification):
    response = await orchestrator.process_query(query)
else:
    raise ComplianceError("Не соответствует требованиям 152-ФЗ")
```

---

## 3. JSON Schema

См. [`152_fz_compliance.json`](152_fz_compliance.json) для детальной схемы.

**Основные поля схемы:**

```json
{
  "consent": {
    "subject_id": "string",
    "purpose": "string",
    "granted_at": "datetime",
    "expires_at": "datetime",
    "revoked_at": "datetime"
  },
  "data_localization": {
    "provider_id": "string",
    "server_location": "RU",
    "verified": true
  },
  "audit_log": {
    "operation": "string",
    "subject_id": "string",
    "timestamp": "datetime",
    "operator_id": "string"
  }
}
```

---

## 4. Примеры использования

### Пример 1: Проверка перед обработкой запроса

```python
from src.ai.compliance import ComplianceChecker

checker = ComplianceChecker()

# Классификация данных
data_class = checker.classify_data(user_query)

if data_class == "pd":
    # Проверка согласия
    if not checker.check_consent(user_id, "code_generation"):
        raise ConsentRequiredError("Требуется согласие на обработку ПДн")
    
    # Проверка локализации
    if not checker.check_localization(provider_id):
        raise LocalizationError("Используйте российский провайдер для ПДн")
    
    # Анонимизация
    anonymized_query = checker.anonymize(user_query)
```

### Пример 2: Аудит операций

```python
from src.ai.compliance import AuditLogger

logger = AuditLogger()

# Логирование операции с ПДн
logger.log_operation(
    operation="code_generation",
    subject_id=user_id,
    data_classification="pd",
    provider_id="gigachat",
    timestamp=datetime.now()
)
```

### Пример 3: Обработка запроса на удаление данных

```python
from src.ai.compliance import DataDeletionHandler

handler = DataDeletionHandler()

# Удаление всех данных субъекта
result = handler.delete_subject_data(
    subject_id=user_id,
    reason="user_request"
)

# Результат должен быть обработан в течение 30 дней
assert result.completed_at - result.requested_at < timedelta(days=30)
```

---

## 5. Best Practices

### 5.1 Минимизация использования ПДн

- Избегайте использования персональных данных в промптах
- Используйте анонимизацию при анализе
- Храните ПДн отдельно от метаданных

### 5.2 Регулярный аудит

- Еженедельная проверка соответствия
- Ежемесячный отчет по метрикам
- Квартальный внешний аудит

### 5.3 Документирование

- Регистрация всех операций с ПДн
- Документирование целей обработки
- Отслеживание согласий субъектов

---

## 6. Соответствие уровням

### Level 1: Basic Compliance
- Проверка локализации данных
- Использование российских провайдеров для ПДн

### Level 2: Enhanced Compliance
- + Проверка согласий
- + Анонимизация данных
- + Базовый аудит

### Level 3: Full Compliance
- + Полный аудит всех операций
- + Автоматическое удаление данных
- + Регулярные проверки

---

## 7. Связанные стандарты

- [GDPR Compliance](GDPR_COMPLIANCE_SPEC.md) - для международных проектов
- [Data Localization](DATA_LOCALIZATION_SPEC.md) - детали локализации
- [Data Privacy](DATA_PRIVACY_SPEC.md) - общие принципы приватности
- [Compliance Audit](COMPLIANCE_AUDIT_SPEC.md) - процесс аудита

---

## 8. Чеклист соответствия

- [ ] Используются только российские провайдеры для ПДн
- [ ] Все соединения зашифрованы (TLS 1.3)
- [ ] Данные хранятся в РФ
- [ ] Проверяется согласие перед обработкой
- [ ] Ведется аудит всех операций
- [ ] Реализована анонимизация данных
- [ ] Обработка запросов на удаление в течение 30 дней
- [ ] Регулярные проверки соответствия

---

**Примечание:** Этот стандарт является обязательным для всех компонентов платформы, работающих с персональными данными граждан РФ.
